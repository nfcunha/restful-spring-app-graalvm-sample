# restful-graalvm-sample

This is simple project generated by [Spring Initializr](https://start.spring.io/) to demonstrate a RESTful web service running on GraalVM native image.

The following dependencies are included:

- Spring Web
- GraalVM Native Support

This project was generated on 24-Oct-2025. Dependency versions may have been updated since then.

## âœ… Prerequisites

- [Java 21 or later](https://jdk.java.net/archive/)
- [GraalVM](https://www.graalvm.org/downloads/)

## ðŸ—ï¸ Build and Run using Gradle Daemon

To build and run the application using the Gradle daemon, use the following Gradle commands.

```bash
./gradlew clean build bootRun --refresh-dependencies
```

This will start the application on `http://localhost:8080` using the Gradle daemon.

## ðŸ‹ Creating a native image 

To create a native image of the application set the following environment variable.

| Environment Variable | Value              |
|----------------------|--------------------|
| `GRAALVM_HOME`       | `/path/to/graalvm` |
 | `JAVA_HOME`        | `/path/to/java`    |

Then run the following command to build the native image using Spring Boot's `bootBuildImage` task. This might fake a few minutes and allocate several resources depending on your system configuration. I'd recommend running this command on a machine with at least 8GB of RAM.

```bash
  sudo ./gradlew clean build bootBuildImage --imageName=restful-graalvm-sample --refresh-dependencies
```
> âš ï¸ You might need to run the command with `sudo` depending on your system configuration.

Check if the image was created successfully by running:

```bash
  sudo docker images | grep restful-graalvm-sample
```

## ðŸš€ Running the native image`

To run the native image, use the following command:

```bash
  sudo docker run -p 8080:8080 restful-graalvm-sample:latest
```

> âš ï¸ The port 8080 is defined as default by Spring. You can change it by setting in the application.properites, defining an environment variable, or passing it as a command-line argument.
> If the port is already in use, you can map it to a different port on your host machine by changing the left side of the `-p` option (e.g., `-p 9090:8080` to map to port 9090).

## ðŸ§ª Testing the application

You can test the application by sending a GET request to the `/sample` endpoint. You can use `curl` or any API testing tool like Postman.
This endpoint is exposed regardless of whether you are running the application using the Gradle daemon or as a native image.

```bash
  curl http://localhost:8080/sample
```

This will return a JSON response like the following. Memory information will vary based on your system.

```json
{
  "message": "Hello from GraalVM with Spring Boot!",
  "availableProcessors": 8,
  "freeMemory": 44432880,
  "totalMemory": 71303168,
  "maxMemory": 8338276352
}
```

## ðŸ“Š Performance and resource usage comparison

Using an existing repository, I have compiled both the JVM and native image versions of this application and measured their performance and resource usage.

First of all, here are the specifications of the machine used for testing:

- CPU: Intel Core i5-1145G7
- RAM: 32 GB DDR4
- OS: Ubuntu 24.04.2 LTS
- Java Version: OpenJDK 21
- GraalVM Version: GraalVM 21.3.0

This specific repository contains a service that requires a database connection, which makes it shutdown if there is no connection provided or the connection fails. This makes it possible to measure exactly the startup time until the shutdown is triggered.

Further metrics can be collected using externals tools, but these results already show the advantages of using GraalVM native images for certain applications, especially in terms of startup time and memory footprint.

The results are as follows (approximate values):

| Metric       | JVM 21 Version     | GraalVM Native Image Version |
|--------------|--------------------|------------------------------|
| Startup Time | ~3400 milliseconds | ~120 milliseconds            |
| Image Size   | ~450 MB            | ~360 MB                      |

